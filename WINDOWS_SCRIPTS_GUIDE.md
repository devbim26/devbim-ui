# Руководство по батникам для запуска и перезапуска Open WebUI

## Обзор

Это руководство описывает создание батников (batch файлов) для управления системой Open WebUI на Windows. Система состоит из двух основных компонентов:
- **Frontend** - SvelteKit приложение, запускается через `npm run dev`
- **Backend** - FastAPI сервер, запускается через `uvicorn`

## Список созданных батников

### Основные батники:

1. **`start-frontend.bat`** - Запуск только Frontend
2. **`start-backend.bat`** - Запуск только Backend
3. **`start-all.bat`** - Запуск всей системы (Frontend + Backend)
4. **`stop-all.bat`** - Остановка всей системы
5. **`restart-all.bat`** - Перезапуск системы
6. **`clean-restart.bat`** - Полная очистка и перезапуск
7. **`webui-manager.bat`** - Универсальный менеджер с интерактивным интерфейсом

## Установка и использование

### Быстрый старт

1. **Первый запуск:**
   ```cmd
   webui-manager.bat
   ```
   Выберите пункт 3 для запуска всей системы.

2. **Обычный запуск:**
   ```cmd
   start-all.bat
   ```

3. **Остановка:**
   ```cmd
   stop-all.bat
   ```

### Подробное описание каждого батника

#### 1. `start-frontend.bat`
- Проверяет наличие Node.js и npm
- Устанавливает зависимости (`npm install`)
- Запускает Pyodide подготовку
- Запускает Frontend сервер разработки
- Показывает URL: http://localhost:5173

#### 2. `start-backend.bat`
- Проверяет наличие Python
- Создает и активирует виртуальное окружение (если не существует)
- Устанавливает зависимости Python
- Настраивает Playwright (если нужно)
- Генерирует секретный ключ
- Запускает Backend сервер на порту 8080

#### 3. `start-all.bat`
- Проверяет наличие всех необходимых компонентов
- Запускает Backend в фоновом окне
- Ожидает запуска Backend (с проверкой health endpoint)
- Запускает Frontend в фоновом окне
- Создает папку logs для логов
- Показывает все URL и инструкции

#### 4. `stop-all.bat`
- Останавливает процессы по названиям окон
- Останавливает Node.js и Python процессы
- Освобождает порты 5173 и 8080
- Показывает статус остановки

#### 5. `restart-all.bat`
- Останавливает текущую систему
- Очищает временные файлы
- Перезапускает систему
- Опционально открывает браузер

#### 6. `clean-restart.bat`
- Полная остановка системы
- Удаление node_modules и .svelte-kit
- Очистка Python кэша
- Удаление старых логов
- Очистка npm и pip кэша
- Полная переустановка зависимостей
- Запуск системы заново

#### 7. `webui-manager.bat`
Интерактивный менеджер с возможностями:
- Запуск/остановка компонентов
- Проверка статуса системы
- Просмотр логов
- Настройки (в разработке)
- Удобный интерфейс выбора

## Требования

### Необходимые компоненты:
- **Node.js** (версия 18.13.0 - 22.x.x)
- **Python** (версия 3.8+)
- **npm** (версия 6.0.0+)
- **Windows PowerShell** (для некоторых функций)

### Проверка перед использованием:
```cmd
node --version
python --version
npm --version
```

## Порты по умолчанию

- **Frontend**: http://localhost:5173
- **Backend**: http://localhost:8080
- **Health Check**: http://localhost:8080/health

## Логирование

Все логи сохраняются в папке `logs/`:
- `frontend_YYYY-MM-DD_HH-MM-SS.log`
- `backend_YYYY-MM-DD_HH-MM-SS.log`

## Решение проблем

### Порт уже занят
Если порт уже занят, измените порт в соответствующем батнике или закройте приложение, использующее порт.

### Ошибки импорта Python
Убедитесь, что виртуальное окружение создано и активировано. Батники делают это автоматически.

### Ошибки npm
Очистите кэш: `npm cache clean --force`
Или используйте `clean-restart.bat` для полной очистки.

### Не запускается Backend
Проверьте, что все зависимости установлены:
```cmd
cd backend
python -m pip install -r requirements.txt
```

## Советы по использованию

1. **Для разработки**: Используйте `webui-manager.bat` для удобного управления
2. **Для быстрого теста**: Используйте `start-all.bat`
3. **При проблемах**: Используйте `clean-restart.bat`
4. **Для мониторинга**: Проверяйте логи в папке `logs/`
5. **Для автоматизации**: Используйте отдельные батники в скриптах

## Безопасность

- Батники проверяют наличие необходимых компонентов перед запуском
- Секретные ключи генерируются автоматически
- Виртуальные окружения изолируют зависимости
- Логи не содержат чувствительной информации

## Поддержка

Если возникли проблемы:
1. Проверьте логи в папке `logs/`
2. Убедитесь, что все требования установлены
3. Используйте `clean-restart.bat` для полной очистки
4. Проверьте, что порты не заняты другими приложениями

## Структура проекта после установки

```
open-webui/
├── start-frontend.bat          # Запуск Frontend
├── start-backend.bat           # Запуск Backend
├── start-all.bat              # Запуск всей системы
├── stop-all.bat               # Остановка системы
├── restart-all.bat            # Перезапуск системы
├── clean-restart.bat          # Полная очистка и перезапуск
├── webui-manager.bat          # Интерактивный менеджер
├── WINDOWS_SCRIPTS_GUIDE.md   # Это руководство
├── logs/                      # Папка с логами
├── backend/                   # Backend часть
│   ├── start_windows.bat     # Существующий батник
│   ├── start.sh              # Существующий скрипт
│   └── ...
├── src/                       # Frontend часть
└── ...
```

## Автоматизация

Для автоматического запуска при загрузке Windows:

1. Создайте ярлык на `start-all.bat`
2. Поместите ярлык в папку автозагрузки:
   ```
   Win + R → shell:startup → Enter
   ```
3. Переместите ярлык в открывшуюся папку

## Заключение

Эти батники обеспечивают полный цикл управления системой Open WebUI на Windows:
- ✅ Простой запуск и остановка
- ✅ Автоматическая проверка зависимостей
- ✅ Логирование всех операций
- ✅ Удобный интерактивный интерфейс
- ✅ Полная очистка и переустановка
- ✅ Обработка ошибок и восстановление

Используйте `webui-manager.bat` для наиболее удобного управления системой!